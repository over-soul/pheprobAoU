% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_utils.R
\name{extract_total_healthcare_utilization}
\alias{extract_total_healthcare_utilization}
\title{Extract EHR Features for PheProb Calculation}
\usage{
extract_total_healthcare_utilization(
  person_ids = NULL,
  domains = c("condition", "procedure", "drug", "measurement", "observation"),
  date_range = NULL,
  exclude_concepts = NULL,
  max_persons = NULL
)
}
\arguments{
\item{person_ids}{A numeric vector of person IDs. If NULL, extracts for all
available persons in the database.}

\item{domains}{A character vector specifying which OMOP domains to include
in total counts. Default: c("condition", "procedure", "drug", "measurement", "observation")}

\item{date_range}{A list with 'start' and 'end' dates (Date objects) to limit
the temporal scope. If NULL, includes all available data.}

\item{exclude_concepts}{Optional vector of concept IDs to exclude from total counts
(e.g., administrative codes that don't represent clinical activity)}

\item{max_persons}{Maximum number of persons to process (for testing/limiting).
If NULL, processes all available persons.}

\item{concept_ids}{A numeric vector of validated OMOP concept IDs}
}
\value{
A tibble with columns:
\item{person_id}{Person identifier}
\item{concept_id}{OMOP concept identifier}
\item{concept_name}{Human-readable concept name}
\item{domain_id}{OMOP domain (condition_occurrence, procedure_occurrence, etc.)}
\item{occurrence_count}{Number of times concept appears for this person}
\item{first_occurrence_date}{Date of first occurrence}
\item{last_occurrence_date}{Date of last occurrence}
\item{days_since_first}{Days between first and last occurrence}
\item{total_records}{Total number of records for this person-concept pair}

A tibble with columns:
\item{person_id}{Person identifier}
\item{total_code_count}{Total number of billing codes across all domains}
\item{condition_count}{Number of condition codes}
\item{procedure_count}{Number of procedure codes}
\item{drug_count}{Number of drug codes}
\item{measurement_count}{Number of measurement codes}
\item{observation_count}{Number of observation codes}
\item{first_code_date}{Date of first billing code}
\item{last_code_date}{Date of last billing code}
\item{healthcare_span_days}{Days between first and last codes}
}
\description{
Extracts relevant electronic health record features from All of Us database
for the specified concept IDs and person IDs.
}
\examples{
\dontrun{
# Extract features for diabetes-related concepts
diabetes_concepts <- c(201826, 4329847)
features <- extract_ehr_features(diabetes_concepts)
head(features)
}
Extract Total Healthcare Utilization Counts

Extracts total billing code counts for each person across all clinical domains.
This is required for the original PheProb binomial mixture model which models
disease-relevant codes as a subset of total healthcare utilization.

\dontrun{
# Extract total healthcare utilization for all patients
total_counts <- extract_total_healthcare_utilization()

# Extract for specific patients with date filtering
specific_counts <- extract_total_healthcare_utilization(
  person_ids = c(12345, 67890),
  date_range = list(start = as.Date("2020-01-01"), end = Sys.Date())
)
}
}
