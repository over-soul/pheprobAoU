% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/allofus_data_extraction.R
\name{extract_allofus_pheprob_data}
\alias{extract_allofus_pheprob_data}
\title{All of Us Data Extraction Functions}
\usage{
extract_allofus_pheprob_data(
  concept_ids,
  person_ids = NULL,
  domains = c("condition_occurrence", "procedure_occurrence", "drug_exposure",
    "measurement", "observation"),
  date_range = NULL,
  expand_concepts = TRUE,
  max_persons = NULL
)
}
\arguments{
\item{concept_ids}{A numeric vector of disease-relevant OMOP concept IDs}

\item{person_ids}{A numeric vector of person IDs. If NULL, uses general population.}

\item{domains}{A character vector specifying which OMOP domains to include.
Currently focuses on condition_occurrence domain for optimal performance.}

\item{date_range}{A list with 'start' and 'end' dates (Date objects) to limit
the temporal scope of data extraction. If NULL, no date filtering is applied.}

\item{expand_concepts}{Logical indicating whether to expand concept hierarchies
using concept_ancestor table (default: TRUE).}

\item{max_persons}{Maximum number of persons to process (for testing/limiting).
If NULL, processes all available persons.}
}
\value{
A tibble with columns required for binomial mixture model:
\item{person_id}{Person identifier}
\item{S}{Disease-relevant code count (using concept hierarchy)}
\item{C}{Total healthcare code count (source-coded conditions)}
\item{success_rate}{S/C ratio}
}
\description{
This file contains functions that properly use the allofus package
for data extraction, replacing the raw SQL approach.
Extract Healthcare Utilization Using Direct SQL Approach
}
\details{
Extracts disease-relevant counts and total healthcare utilization using
direct SQL queries with concept hierarchy expansion and proper healthcare utilization.
This approach fixes critical issues with the previous aou_concept_set method.

This function uses direct SQL queries to extract:
\itemize{
\item S: Disease-relevant billing code count (using concept hierarchy)
\item C: Total healthcare utilization (source-coded conditions)
\item Proper case/control mixture from general population
}

Key improvements over previous approach:
\itemize{
\item Uses concept_ancestor for comprehensive phenotype expansion
\item Counts source-coded conditions for realistic healthcare utilization
\item Uses general population instead of survey-biased cohorts
\item Handles integer64 data types properly
}
}
\examples{
\dontrun{
# Extract data for diabetes phenotyping
diabetes_concepts <- c(201820, 201826, 4193704)
pheprob_data <- extract_allofus_pheprob_data(diabetes_concepts)
}
}
